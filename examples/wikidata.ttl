@base         <https://github.com/AtomGraph/Processor/blob/develop/examples/wikidata> .

@prefix :     <#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:  <http://www.w3.org/2002/07/owl#> .
@prefix ldt:  <https://www.w3.org/ns/ldt#> .
@prefix dht:  <https://www.w3.org/ns/ldt/document-hierarchy/templates#> .
@prefix sp:   <http://spinrdf.org/sp#> .
@prefix spl:  <http://spinrdf.org/spl#> .

: a ldt:Ontology ;
  owl:imports ldt:, dht:, sp: ;
  rdfs:label "Wikidata's LDT ontology" .

:BirthdaysTemplate a ldt:Template ;
  ldt:extends dht:Container ; # we want pagination supported by containers
  rdfs:label "People born today" ;
  ldt:match "/birthdays" ;
  ldt:param :SexParam ;
  ldt:query :BirthdaysQuery ;
  rdfs:isDefinedBy : .

:SexParam a ldt:Parameter ;
  rdfs:label "Sex parameter" ;
  spl:predicate :sex ;
  spl:valueType rdfs:Resource ;
  spl:optional true ;
  rdfs:isDefinedBy : .

:BirthdaysQuery a ldt:Query, sp:Construct ;
  rdfs:label "Birthdays query" ;
  sp:text """PREFIX  bd:   <http://www.bigdata.com/rdf#>
PREFIX  wdt:  <http://www.wikidata.org/prop/direct/>
PREFIX  wikibase: <http://wikiba.se/ontology#>

CONSTRUCT 
  { 
    ?entity <https://github.com/AtomGraph/Processor/blob/develop/examples/wikidata#year> ?year .
  }
WHERE
  { SELECT  ?entity ?year
    WHERE
      { BIND(month(now()) AS ?nowMonth)
        BIND(day(now()) AS ?nowDay)
        ?entity  wdt:P569  ?date
        FILTER ( ( month(?date) = ?nowMonth ) && ( day(?date) = ?nowDay ) )
        SERVICE wikibase:label
          { bd:serviceParam
                      wikibase:language  "en"
          }
        BIND(year(?date) AS ?year)
      }
  }""" ;
  rdfs:isDefinedBy : .